((root, factory) -><%
if (dependencies) { %>
  if typeof define is 'function' and define.amd
    define([<%= _.keys(dependencies).map(wrapInSingleQuotes).join(',')
    %>], factory)
  else if typeof module is 'object' && typeof module.exports is 'object'
    module.exports = factory(<%= _.keys(dependencies).map(function(key) {
      return "require(" + wrapInSingleQuotes(key) + ")";
    }).join(',')%>)
  else<%
    if (namespace) { %>
    root.<%= namespace %> = factory(<%= _.values(dependencies).map(function(val) {
      return 'root.' + val;
    }).join(',')%>)<%
    } else { %>
    factory(<%= _.values(dependencies).map(function(val) {
      return 'root.' + val;
    }).join(',')%>)<%
    } %>
)(@, (<%= _.values(dependencies).join(',') %>) ->
<% } else { %>
  if typeof define is 'function' and define.amd
    define(factory)
  else if typeof module is 'object' && typeof module.exports is 'object'
    module.exports = factory()
  else<%
  if (namespace) { %>
  root.<%= namespace %> = factory()<%
  } else { %>
  factory()
  <% } %>
)(@, ->
<% } %>
  <%= contents %>
)
